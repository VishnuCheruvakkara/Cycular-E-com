{% extends 'partials/base.html' %}
{% load static %}
{% block style %}

{% endblock %}

{% block content %}
	<head>
		<style>
				/* Custom width for modal */
				.custom-modal-width .modal-dialog {
				max-width: 450px; /* Adjust as needed */
				margin: 30px auto; /* Adjust vertical margin if necessary */
			}
		</style>
	</head>
	<body>
        <main class="main mt-2 ">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'core:index' %}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'cart:cart-page' %}">Shopping Cart</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="checkout">



	                <div class="container">
            			<div class="checkout-discount">
            				<form action="#">
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
            			</div><!-- End .checkout-discount -->

						<!-- space to show all address here and add address option  -->

            			<form action="{% url 'payment:check-out' %}" method="post">
							{% csrf_token %}
		                	<div class="row">
								<!-- Add address section -->
								<div class="col-lg-9">
									<h4 class="mb-3">Select Your Shipping Address</h4>
									<div class="address-selection">
										<div class="row">
											<!-- Loop through the addresses here -->
											{% for address in addresses %}
											<div class="col-md-6 mb-4">
												<div class="address-box p-3 border rounded">
													<input type="radio" name="selected_address" id="address-{{ address.id }}" value="{{ address.id }}"
														class="mr-2" {% if forloop.first %}checked{% endif %}>
														<h3 class="card-title">Billing Address - {{ forloop.counter }}</h3>
													<label for="address-{{ address.id }}" class="w-100">
														<div class="address-details mt-2">
															<b>{{ address.user.username }}</b>,
															{{ address.address_line }},
															{{ address.city }},
															{{ address.state }},
															{{ address.country }},
															{{ address.phone_number }}
														</div>
													</label>
												</div>
											</div>
											{% endfor %}
											<!-- End of address loop -->
										</div>
									
										<a href="" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#userAddAddressModal">
											<i class="fas fa-circle-plus"></i> + Add New Address
										</a>

									</div>
								</div>

		                		<aside class="col-lg-3">
		                			<div class="summary">
		                				<h3 class="summary-title">Your Order Details</h3><!-- End .summary-title -->

		                				<table class="table table-summary">
		                					<thead>
		                						<tr>
		                							<th>Product</th>
		                							<th>Total</th>
		                						</tr>
		                					</thead>

		                					<tbody>

												{% for cart_item in cart_items %}
		                						<tr>
		                							<td><a href="#">{{cart_item.product_variant.product.name}}</a> <p>Count : {{cart_item.quantity}}</p></td>
													
		                							<td>₹ {{cart_item.subtotal}}</td>
		                						</tr>
												{% endfor %}
	
		                						<tr class="summary-subtotal">
		                							<td>Subtotal:</td>
		                							<td>₹ {{total_price}}</td>
		                						</tr><!-- End .summary-subtotal -->
		                						<tr>
		                							<td>Shipping:</td>
		                							<td><b>Free shipping</b></td>
		                						</tr>
		                						<tr class="summary-total">
		                							<td><b>Total:</b></td>
		                							<td><b>₹ {{total_price}}</b></td>
		                						</tr><!-- End .summary-total -->
		                					</tbody>
		                				</table><!-- End .table table-summary -->

		                				<div class="accordion-summary" id="accordion-payment">
										    <div class="card">
										        <div class="card-header" id="heading-1">
										            <h2 class="card-title">
										                <a role="button" data-toggle="collapse" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
										                    Direct bank transfer
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-1" class="collapse show" aria-labelledby="heading-1" data-parent="#accordion-payment">
										            <div class="card-body">
										                Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-2">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
										                    Check payments
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-2" class="collapse" aria-labelledby="heading-2" data-parent="#accordion-payment">
										            <div class="card-body">
										                Ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. 
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-3">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
										                    Cash on delivery
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordion-payment">
										            <div class="card-body">Cash on Delivery (COD) is a payment method that allows you to pay for your order in cash when it is delivered to your doorstep. This option provides a secure and convenient way to shop online without needing a credit card or making an online payment upfront. 
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-4">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
										                    PayPal <small class="float-right paypal-link">What is PayPal?</small>
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-4" class="collapse" aria-labelledby="heading-4" data-parent="#accordion-payment">
										            <div class="card-body">
										                Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede. Donec nec justo eget felis facilisis fermentum.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->

										    <div class="card">
										        <div class="card-header" id="heading-5">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
										                    Credit Card (Stripe)
										                    <img src="{% static 'assets/images/payments-summary.png' %}" alt="payments cards">
										                </a>
										            </h2>
										        </div><!-- End .card-header -->
										        <div id="collapse-5" class="collapse" aria-labelledby="heading-5" data-parent="#accordion-payment">
										            <div class="card-body"> Donec nec justo eget felis facilisis fermentum.Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Lorem ipsum dolor sit ame.
										            </div><!-- End .card-body -->
										        </div><!-- End .collapse -->
										    </div><!-- End .card -->
										</div><!-- End .accordion -->

		                				<button type="submit" class="btn btn-outline-primary-2 btn-order btn-block">
		                					<span class="btn-text">Place Order</span>
		                					<span class="btn-hover-text">Confirm</span>
		                				</button>
		                			</div><!-- End .summary -->
		                		</aside><!-- End .col-lg-3 -->
		                	</div><!-- End .row -->
            			</form>
	                </div><!-- End .container -->



                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
		<!-- Modal for add address -->
		<div class="modal fade custom-modal-width " id="userAddAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
			<div class="modal-dialog " role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form method="post" action="{% url 'payment:add-address-checkout' %}">
							{% csrf_token %}
							<div class="form-group col-md-12 ">
								<label for="address_line">Address Line</label>
								<input type="text" name="address_line" class="form-control" required>
								{% if errors.address_line %}
								<div class="text-danger">{{ errors.address_line }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="city">City</label>
								<input type="text" name="city" class="form-control" required>
								{% if errors.city %}
								<div class="text-danger">{{ errors.city }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="state">State</label>
								<input type="text" name="state" class="form-control" required>
								{% if errors.state %}
								<div class="text-danger">{{ errors.state }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="country">Country</label>
								<input type="text" name="country" class="form-control" required>
								{% if errors.country %}
								<div class="text-danger">{{ errors.country }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="postal_code">Postal Code</label>
								<input type="text" name="postal_code" class="form-control" required>
								{% if errors.postal_code %}
								<div class="text-danger">{{ errors.postal_code }}</div>
								 {% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="phone_number">Phone Number</label>
								<input type="text" name="phone_number" class="form-control">
								{% if errors.phone_number %}
								<div class="text-danger">{{ errors.phone_number }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="is_default">Default Address</label>
								<input type="checkbox" name="is_default">
							
							</div>
							<div class="d-flex justify-content-center mt-3">
								<button type="submit" class="btn btn-primary mb-1">Add Address</button>
							
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- End address section -->

		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
        {% for message in messages %}
            swal.fire({
                icon:"{{message.tags}}",
                title:"{{message}}",
                text:"{{message.tags}}",
            })
        {% endfor %}
        </script>
		<!-- Bootstrap and jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

	</body>
{% endblock %}
