{% extends 'partials/base.html' %}
{% load static %}
{% block style %}

{% endblock %}

{% block content %}
	<head>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<style>
				/* Custom width for modal */
				.custom-modal-width .modal-dialog {
				max-width: 450px; /* Adjust as needed */
				margin: 30px auto; /* Adjust vertical margin if necessary */
			}
			#payment-toggle {
				cursor: pointer; /* Changes cursor to pointer when hovering over the toggle switch */
			}
			/* Style the radio buttons */
			input[type="radio"] {
				cursor: pointer; /* Changes cursor to pointer when hovering over radio buttons */
			}

			/* Style the checkboxes */
			input[type="checkbox"] {
				cursor: pointer; /* Changes cursor to pointer when hovering over checkboxes */
			}

			/* Optional: If you want the pointer cursor on the label as well */
			label {
				cursor: pointer; /* Changes cursor to pointer when hovering over labels */
			}

		</style>

<style>
	/* Coupon-specific styles */
#couponCanvas .card {
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-bottom: 1rem;
  max-width: 450px;
}

#couponCanvas .card .main {
  display: flex;
  align-items: center;
  padding: 0.75rem;
  background-color: #f9f9f9;
}

#couponCanvas .card .co-img {
  width: 40px;
  height: 40px;
  overflow: hidden;
  border-radius: 50%;
  margin-right: 0.75rem;
}

#couponCanvas .card .co-img img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#couponCanvas .card .vertical {
  height: 35px;
  width: 1px;
  background-color: #e0e0e0;
  margin: 0 0.75rem;
}

#couponCanvas .card .content {
  flex-grow: 2;
}

#couponCanvas .card .content h2 {
  font-size: 2rem;
  color: #333;
  margin: 0 0 0.25rem;
}

#couponCanvas .card .content h1 {
  font-size: 2.5rem;
  color: #1cc0a0;
  margin: 0 0 0.25rem;
}

#couponCanvas .card .content h1 span {
  font-size: 1.25rem;
  color: #666;
}

#couponCanvas .card .content p {
  font-size: 1rem;
  color: #333131;
  margin: 0;
}

#couponCanvas .card .copy-button {
  display: flex;
  padding: 0.5rem;
  background-color: #fff;
  border-top: 1px solid #e0e0e0;
}

#couponCanvas .card .copy-button input {
  flex-grow: 1;
  border: 1px solid #ccc;
  border-radius: 4px 0 0 4px;
  padding: 0.2rem 2.75rem;
  font-size: 1.5rem;
}

#couponCanvas .card .copy-button .copybtn {
  background-color:#1cc0a0 ;
  color: white;
  border: none;
  border-radius: 0 4px 4px 0;
  padding: 0.25rem 0.5rem;
  font-size: 1.5rem;
  cursor: pointer;
}

/* Applied Coupon Styles */
.coupon-container .card {
  position: relative;
  margin-top: 1rem;
  max-width: 300px;
}

.coupon-container .close-button {
  position: absolute;
  top: 0.25rem;
  right: 0.25rem;
  font-size: 1rem;
  color: #888;
  cursor: pointer;
  z-index:500;
}

/* Responsive adjustments */
@media (max-width: 350px) {
  #couponCanvas .card,
  .coupon-container .card {
    max-width: 100%;
  }

  #couponCanvas .card .main {
    flex-direction: column;
    text-align: center;
  }

  #couponCanvas .card .co-img {
    margin-right: 0;
    margin-bottom: 0.5rem;
  }

  #couponCanvas .card .vertical {
    display: none;
  }
}


</style>


<style>
	

	/* Off-Canvas Menu Styles */
.offcanvas {
    position: fixed;
    top: 0;
    right: 0;
    width: 450px;
    height: 100%;
    background-color: #f8f9fa;
    transform: translateX(100%);
    transition: transform 0.3s ease-in-out;
    box-shadow: -2px 0 5px rgba(0,0,0,0.3);
    z-index: 2;
    overflow-y: auto;
}

.offcanvas.show {
    transform: translateX(0);
}

.offcanvas-header {
    padding: 16px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.offcanvas-title {
    margin: 0;
}

.btn-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
}

/* Coupon Card Styles */
.card {
    margin: 16px;
    padding: 16px;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    background-color: #ffffff;
    display: flex;
    align-items: center;
}

.card .main {
    display: flex;
    flex-direction: row;
}

.co-img img {
    width: 100px;
    height: auto;
    border-radius: 8px;
}

.vertical {
    width: 1px;
    background-color: #dee2e6;
    margin: 0 16px;
}

.content h1 {
    margin: 0;
}

.copy-button {
    margin-top: 16px;
}

</style>
	



	</head>
	<body>
        <main class="main mt-2 ">
            <div class="page-header text-center" style="background-image: url('{% static 'assets/images/page-header-bg.jpg' %}')">
        	
        		<div class="container">
        			<h1 class="page-title">Checkout<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'core:index' %}">Home</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'cart:cart-page' %}">Shopping Cart</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="checkout">



	                <div class="container">



            			<div class="checkout-discount">
            				<form action="#">
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
						
            			</div><!-- End .checkout-discount -->



						<button class="btn btn-primary btn-sm mt-2 mb-3" id="showCouponsBtn">Show All Available Coupons</button>

						<!-- Off-Canvas for Available Coupons -->
						<div id="couponCanvas" class="offcanvas">
							<div class="offcanvas-header">
								<h5 class="offcanvas-title">Available Coupons</h5>
								<button id="closeBtn" class="btn-close"><i class="fa fa-close"></i></button>
							</div>
							<div class="offcanvas-body">
								<div class="coupon-list">
									<!-- Coupon Card 1 -->
									<div class="card">
										<div class="main">
											<div class="co-img">
												<img src="https://i.pinimg.com/originals/c7/84/67/c78467db9ff497393cb548a48f02d451.png" alt="">
											</div>
											<div class="vertical"></div>
											<div class="content">
												<h2>Mcdonalds</h2>
												<h1>10% <span>Coupon</span></h1>
												<p>Valid till 30 April 2024</p>
											</div>
										</div>
										<div class="copy-button">
											<input id="copyvalue1" type="text" readonly value="GOFREE" />
											<button onclick="copyIt('copyvalue1')" class="copybtn">COPY</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					
						<!-- Coupon Applied Section -->
						<div class="coupon-container"></div>

						<script>
						document.getElementById('showCouponsBtn').addEventListener('click', function() {
							document.getElementById('couponCanvas').classList.add('show');
						});

						document.getElementById('closeBtn').addEventListener('click', function() {
							document.getElementById('couponCanvas').classList.remove('show');
						});

						function copyIt(copyFieldId) {
							let copyInput = document.getElementById(copyFieldId);
							copyInput.select();
							document.execCommand("copy");
							Swal.fire({
								title: 'Coupon Copied!',
								text: 'The coupon has been copied to your clipboard.',
								icon: 'success',
								confirmButtonText: 'OK'
							}).then(() => {
								// Close the off-canvas when the SweetAlert2 popup is closed
								document.getElementById('couponCanvas').classList.remove('show');
							});
						}


						</script>
					




						<!-- space to show all address here and add address option  -->

            			<form action="{% url 'payment:check-out' %}" method="post">
							{% csrf_token %}
		                	<div class="row">
								<!-- Add address section -->
								<div class="col-lg-9">
									<h4 class="mb-3">Select Your Shipping Address</h4>
									<div class="address-selection">
										<div class="row">
											<!-- Loop through the addresses here -->
											{% for address in addresses %}
											<div class="col-md-6 mb-4">
												<div class="address-box p-3 border rounded">
													<input type="radio" name="selected_address" id="address-{{ address.id }}" value="{{ address.id }}"
														class="mr-2" {% if forloop.first %}checked{% endif %}>
														<h3 class="card-title">Billing Address - {{ forloop.counter }}</h3>
													<label for="address-{{ address.id }}" class="w-100">
														<div class="address-details mt-2">
															<b>{{ address.user.username }}</b>,
															{{ address.address_line }},
															{{ address.city }},
															{{ address.state }},
															{{ address.country }},
															{{ address.phone_number }}
														</div>
													</label>
												</div>
											</div>
											{% endfor %}
											<!-- End of address loop -->
										</div>
									
										<a href="" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#userAddAddressModal">
											<i class="fas fa-circle-plus"></i> + Add New Address
										</a>

									</div>
								</div>

		                		<aside class="col-lg-3">
		                			<div class="summary">
		                				<h3 class="summary-title">Your Order Details</h3><!-- End .summary-title -->

		                				<table class="table table-summary">
		                					<thead>
		                						<tr>
		                							<th>Product</th>
		                							<th>Total</th>
		                						</tr>
		                					</thead>

		                					<tbody>

												{% for cart_item in cart_items %}
		                						<tr>
		                							<td><a href="#">{{cart_item.product_variant.product.name}}</a> <p>Count : {{cart_item.quantity}}</p></td>
													
		                							<td>₹ {{cart_item.subtotal}}</td>
		                						</tr>
												{% endfor %}
	
		                						<tr class="summary-subtotal">
		                							<td>Subtotal:</td>
		                							<td>₹ {{total_price}}</td>
		                						</tr><!-- End .summary-subtotal -->
		                						<tr>
		                							<td>Shipping:</td>
		                							<td><b>Free shipping</b></td>
		                						</tr>
		                						<tr class="summary-total">
		                							<td><b>Total:</b></td>
		                							<td><b>₹ {{total_price}}</b></td>
		                						</tr><!-- End .summary-total -->
		                					</tbody>
		                				</table><!-- End .table table-summary -->



										<div class="container mt-5">
											<!-- Toggle Switch -->
											<div class="form-group">
												<h5 for="payment-toggle">Select Payment Method</h5>
											
											</div>
									
											<!-- Accordion for Payment Methods -->
											<div class="accordion-summary" id="accordion-payment">
											
												<!-- Wallet Payment Section -->
												<div class="card mt-3">
													<div class="card-header" id="heading-5">
														<h2 class="card-title">
															<!-- Radio button input for Wallet Payments -->
															<input type="radio" name="payment_method" id="wallet-payment" value="wallet_payment" data-toggle="collapse" data-target="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
															<label for="wallet-payment" class="ml-2">Wallet</label>
														</h2>
													</div><!-- End .card-header -->
													<div id="collapse-5" class="collapse" aria-labelledby="heading-5" data-parent="#accordion-payment">
														<div class="card-body">
															Wallet payments allow you to use your digital wallet balance to pay for your order securely and conveniently. This method supports popular wallets like Paytm, Google Pay, PhonePe, and others, making the checkout process fast and hassle-free.
														</div><!-- End .card-body -->
													</div><!-- End .collapse -->
												</div><!-- End .card -->
									
												<!-- Cash on Delivery Section -->
												<div class="card mt-3">
													<div class="card-header" id="heading-3">
														<h2 class="card-title">
															<!-- Radio button input for Cash on Delivery -->
															<input type="radio" name="payment_method" id="COD" value="cash_on_delivery" data-toggle="collapse" data-target="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
															<label for="cod" class="ml-2">Cash on delivery</label>
														</h2>
													</div><!-- End .card-header -->
													<div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordion-payment">
														<div class="card-body">
															Cash on Delivery (COD) is a payment method that allows you to pay for your order in cash when it is delivered to your doorstep. This option provides a secure and convenient way to shop online without needing a credit card or making an online payment upfront.
														</div><!-- End .card-body -->
													</div><!-- End .collapse -->
												</div><!-- End .card -->
									
												<!-- Razorpay Section -->
												<div class="card mt-3">
													<div class="card-header" id="heading-4">
														<h2 class="card-title">
															<!-- Radio button input for Razorpay -->
															<input type="radio" name="payment_method" id="razorpay" value="razorpay" data-toggle="collapse" data-target="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
															<label for="razorpay" class="ml-2">Razorpay</label>
														</h2>
													</div><!-- End .card-header -->
													<div id="collapse-4" class="collapse" aria-labelledby="heading-4" data-parent="#accordion-payment">
														<div class="card-body">
															Razorpay is a secure and versatile online payment gateway that allows businesses to accept, process, and disburse payments with ease. It supports various payment methods, including credit/debit cards, UPI, and net banking.
														</div><!-- End .card-body -->
													</div><!-- End .collapse -->
												</div><!-- End .card -->
									
											</div><!-- End .accordion-summary -->
										</div><!-- End .container -->
									
										   

										  
										</div><!-- End .accordion -->

		                				<button type="submit" class="btn btn-outline-primary-2 btn-order btn-block">
		                					<span class="btn-text">Place Order</span>
		                					<span class="btn-hover-text">Confirm</span>
		                				</button>
		                			</div><!-- End .summary -->
		                		</aside><!-- End .col-lg-3 -->
		                	</div><!-- End .row -->
            			</form>
	                </div><!-- End .container -->



                </div><!-- End .checkout -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->
		<!-- Modal for add address -->
		<div class="modal fade custom-modal-width " id="userAddAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalLabel" aria-hidden="true">
			<div class="modal-dialog " role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="addAddressModalLabel">Add New Address</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form method="post" action="{% url 'payment:add-address-checkout' %}">
							{% csrf_token %}
							<div class="form-group col-md-12 ">
								<label for="address_line">Address Line</label>
								<input type="text" name="address_line" class="form-control" required>
								{% if errors.address_line %}
								<div class="text-danger">{{ errors.address_line }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="city">City</label>
								<input type="text" name="city" class="form-control" required>
								{% if errors.city %}
								<div class="text-danger">{{ errors.city }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="state">State</label>
								<input type="text" name="state" class="form-control" required>
								{% if errors.state %}
								<div class="text-danger">{{ errors.state }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="country">Country</label>
								<input type="text" name="country" class="form-control" required>
								{% if errors.country %}
								<div class="text-danger">{{ errors.country }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="postal_code">Postal Code</label>
								<input type="text" name="postal_code" class="form-control" required>
								{% if errors.postal_code %}
								<div class="text-danger">{{ errors.postal_code }}</div>
								 {% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="phone_number">Phone Number</label>
								<input type="text" name="phone_number" class="form-control">
								{% if errors.phone_number %}
								<div class="text-danger">{{ errors.phone_number }}</div>
								{% endif %}
							</div>
							<div class="form-group col-md-12">
								<label for="is_default">Default Address</label>
								<input type="checkbox" name="is_default">
							
							</div>
							<div class="d-flex justify-content-center mt-3">
								<button type="submit" class="btn btn-primary mb-1">Add Address</button>
							
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- End address section -->

		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
        {% for message in messages %}
            swal.fire({
                icon:"{{message.tags}}",
                title:"{{message}}",
                text:"{{message.tags}}",
            })
        {% endfor %}
        </script>
		<!-- Bootstrap and jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
	// Function to update cart count
	function updateCartCount() {
		fetch('{% url "cart:cart-count" %}', {
			method: 'GET',
			headers: {
				'X-Requested-With': 'XMLHttpRequest',
				'X-CSRFToken': '{{ csrf_token }}'
			}
		})
		.then(response => response.json())
		.then(data => {
			if (data.status === 'success') {
				document.querySelector('.cart-count').textContent = data.count;
			} else {
				console.error('Failed to fetch cart count:', data.message);
			}
		})
		.catch(error => console.error('Error:', error));
	}

	// Call the updateCartCount function when the page loads
	document.addEventListener('DOMContentLoaded', updateCartCount);

</script>

</body>
{% endblock %}
