{% extends 'partials/base.html' %}
{% load static %}

{% block content %}
<head>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- SweetAlert CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <style>
        /* Custom width for modal */
        .custom-modal-width .modal-dialog {
            max-width: 450px; /* Adjust as needed */
            margin: 30px auto; /* Adjust vertical margin if necessary */
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
</head>
<body>
        <main class="main mt-2 ">
        	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">My Account<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{% url 'core:index' %}">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">My Account</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->




            <main class="container text-center">
                <div class="success-message" style="margin-top: 0px;">
                    <h4>Order History</h4>
                    <div class="table-container">
                        <table class="table responsive-table">
                            <thead>
                                <tr>
                                    <th>Sl No</th>
                                    <th>Image</th>
                                    <th>Product Name</th>
                                    <th>Order Date</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Count</th>
                                    <th>Cancel</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order_item in order_items %}
                                   
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <a href="{% url 'products:single-product-view' order_item.product_variant.id %}"><img src="{{order_item.product_variant.image1.url}}" alt="{{ item.product.name }}" class="img-thumbnail" style="width: 50px; height: 50px;"></a>
                                        </td>
                                        <td><a href="{% url 'products:single-product-view' order_item.product_variant.id %}">{{ order_item.product_variant.product.name }}</a></td>
                                        <td>{{ order_item.order.order_date }}</td>
                                        <td>â‚¹ {{ order_item.price }}</td>
                                        <td>{{ order_item.order_item_status }}</td>
                                        <td>
                                        {% if order_item.order_item_status == 'Cancell' %}
                                        <p>0</p>
                                        {% else %}
                                        <p>{{ order_item.quantity }}</p>
                                        {% endif %}
                                        </td>
                                        <td>
                                            <a href="{% url 'user_side:order-item-cancell' order_item.id %}" class="btn btn-danger btn-sm cancel-order-item-btn" data-url="{% url 'user_side:order-item-cancell' order_item.id %}">
                                                Cancel
                                            </a>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="8">No items found for this order.</td>
                                    </tr>
                                    
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
            





            
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
        {% for message in messages %}
            swal.fire({
                icon:"{{message.tags}}",
                title:"{{message}}",
                text:"{{message.tags}}",
            })
        {% endfor %}
        </script>

    <script>
       

       document.addEventListener('DOMContentLoaded', function () {
    // Get all cancel buttons
    document.querySelectorAll('.cancel-order-item-btn').forEach(button => {
        button.addEventListener('click', function (event) {
            event.preventDefault(); // Prevent the default button behavior
            
            // Get the cancellation URL from data attribute
            const cancelUrl = this.getAttribute('data-url');
            
            // Show the SweetAlert confirmation dialog
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you really want to cancel this order item? This action cannot be undone.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, cancel it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // If the user confirms, redirect to the cancellation URL
                    window.location.href = cancelUrl;
                }
            });
        });
    });
});

    </script>

    <!-- Plugins JS File -->
    <script src="{% static 'assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery.hoverIntent.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery.waypoints.min.js' %}"></script>
    <script src="{% static 'assets/js/superfish.min.js' %}"></script>
    <script src="{% static 'assets/js/owl.carousel.min.js' %}"></script>
    

    <!-- Main JS File -->
    <script src="{% static 'assets/js/main.js' %}"></script>
   

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

    <!-- for the sweet alert  -->
 
    
<script>
	// Function to update cart count
	function updateCartCount() {
		fetch('{% url "cart:cart-count" %}', {
			method: 'GET',
			headers: {
				'X-Requested-With': 'XMLHttpRequest',
				'X-CSRFToken': '{{ csrf_token }}'
			}
		})
		.then(response => response.json())
		.then(data => {
			if (data.status === 'success') {
				document.querySelector('.cart-count').textContent = data.count;
			} else {
				console.error('Failed to fetch cart count:', data.message);
			}
		})
		.catch(error => console.error('Error:', error));
	}

	// Call the updateCartCount function when the page loads
	document.addEventListener('DOMContentLoaded', updateCartCount);

</script>


</body>


<!-- molla/dashboard.html  22 Nov 2019 10:03:13 GMT -->
</html>

{% endblock %}

