{% include 'partials/side-bar-admin.html' %}
{% load static %}

<!doctype html>
<html class="no-js " lang="en">


<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
<meta name="description" content="Responsive Bootstrap 4 and web Application ui kit.">

<title>:: Aero Bootstrap4 Admin :: Ticket List</title>
<!-- Favicon-->
<link rel="icon" href="favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="{% static 'admin/plugins/bootstrap/css/bootstrap.min.css' %}">
<!-- Custom Css -->
<link rel="stylesheet" href="{% static 'admin/css/style.min.css' %}">
</head>

<body class="theme-blush">

<!-- Page Loader -->
<div class="page-loader-wrapper">
    <div class="loader">
        <div class="m-t-30"><img class="zmdi-hc-spin" src="{% static 'admin/images/loader.svg' %}" width="48" height="48" alt="Aero"></div>
        <p>Please wait...</p>
    </div>
</div>






<!-- Overlay For Sidebars -->
<div class="overlay"></div>

<!-- Main Search -->
<div id="search">
    <button id="close" type="button" class="close btn btn-primary btn-icon btn-icon-mini btn-round">x</button>
    <form>
        <input type="search" value="" placeholder="Search..." />
        <button type="submit" class="btn btn-primary">Search</button>
    </form>
</div>
<!-- Main Content -->
<section class="content">
    <div class="body_scroll">
        <div class="block-header">
            <div class="row">
                <div class="col-lg-7 col-md-6 col-sm-12">
                    <h2>Customers</h2>
                    <ul class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html"><i class="zmdi zmdi-home"></i> Home</a></li>
                        <li class="breadcrumb-item">Customers</li>
                    </ul>
                    <button class="btn btn-primary btn-icon mobile_menu" type="button"><i class="zmdi zmdi-sort-amount-desc"></i></button>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <!-- table starts here  -->
            <div class="row clearfix">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="card project_list">
                        <div class="table-responsive">
                            <table class="table table-hover c_table">
                                <thead>
                                    <tr>
                                        <th> Sl.no.</th>
                                        <th>Customer Name</th>
                                        <th>Email Adress</th>
                                        <th>Date</th>
                                        <th>Time</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for customer in customers %}
                                    <tr>
                                        <td><strong>{{ forloop.counter }}</strong></td>
                                        <td>{{customer.username}}</td>
                                        <td>{{customer.email}}</td>
                                        <td>{{customer.date_joined|date:"d-m-Y"}}</td>
                                        <td>{{customer.date_joined|date:"H:i:s"}}</td>
                                        <td>
                                            <button class="btn status-btn" data-id="1" data-status="active">
                                                {% if user.is_active %}
                                                    Block User
                                                {% else %}
                                                    Activate User
                                                {% endif %}
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <ul class="pagination pagination-primary mt-4">
                            <li class="page-item active"><a class="page-link" href="javascript:void(0);">1</a></li>
                            <li class="page-item"><a class="page-link" href="javascript:void(0);">2</a></li>
                            <li class="page-item"><a class="page-link" href="javascript:void(0);">3</a></li>
                            <li class="page-item"><a class="page-link" href="javascript:void(0);">4</a></li>
                            <li class="page-item"><a class="page-link" href="javascript:void(0);">5</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Jquery Core Js --> 
<script src="{% static 'admin/bundles/libscripts.bundle.js' %}"></script> <!-- Lib Scripts Plugin Js --> 
<script src="{% static 'admin/bundles/vendorscripts.bundle.js' %}"></script> <!-- Lib Scripts Plugin Js --> 

<script src="{% static 'admin/bundles/sparkline.bundle.js' %}"></script>
<script src="{% static 'admin/bundles/mainscripts.bundle.js' %}"></script>
<script src="{% static 'admin/js/pages/charts/sparkline.js' %}"></script>
</body>


</html>


{% block style %}
    <style>
        .status-btn {
            padding: 5px 10px;
            border: none;
            color: white;
            cursor: pointer;
        }

        .status-btn.active {
            background-color: #04be5b;
        }

        .status-btn.blocked {
            background-color: #ee2558;
        }
    </style>
{% endblock %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.toggle-status-button').forEach(button => {
        button.addEventListener('click', function() {
            const userId = this.dataset.userId;  // Retrieve user ID from the data attribute of the button

            fetch(`/toggle-user-status/${userId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')  // Ensure CSRF token is included
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else if (response.status === 404) {
                    throw new Error('User not found');
                }
            })
            .then(data => {
                if (data.status === 'success') {
                    const newStatus = data.new_status;
                    // Update the UI based on the new status
                    button.textContent = newStatus === 'active' ? 'Block User' : 'Activate User';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Optionally display an error message to the user
            });
        });
    });
});

// Function to get the CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>

{% endblock %}